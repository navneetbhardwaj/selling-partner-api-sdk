/*
 * The Selling Partner API for Amazon Seller Wallet Open Banking API
 * The Selling Partner API for Seller Wallet (Seller Wallet API) provides financial information that is relevant to a seller's Seller Wallet account. You can obtain financial events, balances, and transfer schedules for Seller Wallet accounts. You can also schedule and initiate transactions.
 *
 * OpenAPI spec version: 2024-03-01
 *
 *
 * NOTE: This class is auto generated by the swagger code generator program.
 * https://github.com/swagger-api/swagger-codegen.git
 * Do not edit the class manually.
 */

package software.amazon.spapi;

import io.github.bucket4j.BandwidthBuilder.BandwidthBuilderBuildStage;
import io.github.bucket4j.BandwidthBuilder.BandwidthBuilderCapacityStage;
import java.time.Duration;
import java.util.List;
import java.util.Map;
import java.util.function.Function;
import org.yaml.snakeyaml.Yaml;

public class Configuration {
    private final Map<String, List<Integer>> rateLimitConfiguration =
            new Yaml().load(this.getClass().getClassLoader().getResourceAsStream("rate-limits.yml"));
    private static Configuration instance;

    private Configuration() {}

    public Function<BandwidthBuilderCapacityStage, BandwidthBuilderBuildStage> getLimit(String operation) {
        return limit -> limit.capacity(getValue(operation, 1))
                .refillGreedy(getValue(operation, 0), Duration.ofSeconds(getValue(operation, 2)));
    }

    private Integer getValue(String operation, Integer position) {
        if (rateLimitConfiguration.containsKey(operation)) {
            if (rateLimitConfiguration.get(operation).size() > position) {
                return rateLimitConfiguration.get(operation).get(position);
            }
        }

        return 1;
    }

    public static Configuration get() {
        if (instance == null) {
            instance = new Configuration();
        }
        return instance;
    }
}
